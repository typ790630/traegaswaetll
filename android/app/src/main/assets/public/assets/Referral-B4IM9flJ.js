import{c as v,q as _,i as U,R as g,k as P,M as G,n as H,C as ae,N as f,u as te,a as ne,b as ie,r as h,j as e,B as m,I as ce}from"./index-DiZJZs_I.js";import{C,a as k}from"./card-C8Plr-Mm.js";import{c as K}from"./createWalletClient-Cil49Xqc.js";import{A as oe}from"./arrow-left-LfTt41SV.js";import{G as le}from"./gift-B_f8KHK_.js";import{C as O}from"./copy-EbfEcPKK.js";import{S as de}from"./share-2-6n9Vbpp3.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],q=v("circle-check-big",me);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],fe=v("coins",xe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],ue=v("flame",he);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],be=v("users",pe),S={getData:async s=>{const t=await f.getReferrer(s),i=await f.getInviteCount(s),o=await f.getTotalRewardsEarned(s),n=await f.rewardClaimed(s),x=await f.getInvitees(s),y=await f.getTotalCommissions(s);return{referrer:t!=="0x0000000000000000000000000000000000000000"?t:null,inviteCode:s,totalRewards:o,totalCommissions:y,inviteCount:i,invitees:x,isRewardClaimed:n}},getBalance:async s=>{const t=await ae.getErc20Balance("0xe2188a2e0a41a50f09359e5fe714d5e643036f2a",s);return parseFloat(t)},bindReferrer:async(s,t)=>{try{console.log("[ReferralService] ðŸ” Binding referrer with EOA...");const i=_(s);console.log(`[ReferralService] Account: ${i.address}`);const n=await K({account:i,chain:P,transport:U(g.rpcUrl)}).writeContract({address:g.referralRegistryAddress,abi:G,functionName:"bindReferrer",args:[t]});console.log(`[ReferralService] âœ… Transaction sent: ${n}`);const x=await H.waitForTransactionReceipt({hash:n,confirmations:1});return console.log(`[ReferralService] âœ… Transaction confirmed: ${x.status}`),{success:x.status==="success",txHash:n}}catch(i){return console.error("[ReferralService] âŒ Bind referrer failed",i),{success:!1,error:i.message||"Transaction failed"}}},claimReward:async s=>{try{console.log("[ReferralService] ðŸŽ Claiming reward with EOA...");const t=_(s);console.log(`[ReferralService] Account: ${t.address}`);const o=await K({account:t,chain:P,transport:U(g.rpcUrl)}).writeContract({address:g.referralRegistryAddress,abi:G,functionName:"claimReward",args:[]});console.log(`[ReferralService] âœ… Transaction sent: ${o}`);const n=await H.waitForTransactionReceipt({hash:o,confirmations:1});return console.log(`[ReferralService] âœ… Transaction confirmed: ${n.status}`),{success:n.status==="success",txHash:o}}catch(t){return console.error("[ReferralService] âŒ Claim reward failed",t),{success:!1,error:t.message||"Transaction failed"}}}},z="RADRS";function ke(){const{t:s}=te(),t=ne(),{getCurrentWallet:i,getCurrentNetwork:o,addActivity:n,referral:x,setReferralData:y,updateAssetBalance:B,getPrivateKey:W}=ie(),a=i(),u=o(),[V,Y]=h.useState(x),{referrer:j,inviteCount:J,totalRewards:A,isClaimed:Q,invitees:N,totalCommissions:D}=V,[l,X]=h.useState(""),[ge,T]=h.useState(!1),[Z,F]=h.useState(!1),[ee,E]=h.useState(!1),w=u==null?void 0:u.assets.find(r=>r.symbol===z),d=parseFloat((w==null?void 0:w.balance)||"0"),p=j&&j!=="0x0000000000000000000000000000000000000000",b=l.toLowerCase()===(a==null?void 0:a.address.toLowerCase()),$=l.startsWith("0x")&&l.length===42;h.useEffect(()=>{a!=null&&a.address&&R()},[a==null?void 0:a.address]);const R=async()=>{if(a){T(!0);try{const r=await S.getData(a.address);Y({referrer:r.referrer||"",inviteCount:r.inviteCount,totalRewards:r.totalRewards,totalCommissions:r.totalCommissions,invitees:r.invitees,isClaimed:r.isRewardClaimed}),y({referrer:r.referrer||"",inviteCount:r.inviteCount,totalRewards:r.totalRewards,totalCommissions:r.totalCommissions,invitees:r.invitees,isClaimed:r.isRewardClaimed})}catch(r){console.error("Error loading referral data",r)}finally{T(!1)}}},I=()=>a!=null&&a.id?W(a.id):"",se=async()=>{if(!(!l||!a||!$||b)){F(!0);try{const r=I();if(!r)throw new Error("No private key found");const c=await S.bindReferrer(r,l);c.success?(await R(),n({type:"Contract",asset:"Referral",amount:"Bind",status:"Success",hash:c.txHash||`0x${Math.random().toString(16).substr(2,16)}`,timestamp:Date.now()})):alert(c.error||"Bind failed")}catch(r){console.error(r),alert(r.message||"Transaction failed")}finally{F(!1)}}},re=async()=>{if(!(d<200)){E(!0);try{const r=I();if(!r)throw new Error("No private key found");const c=await S.claimReward(r);c.success?(await R(),u&&B(u.id,z,"5","add"),n({type:"Receive",asset:"RADRS",amount:"+5.00",status:"Success",hash:c.txHash||`0x${Math.random().toString(16).substr(2,16)}`,timestamp:Date.now()})):alert(c.error||"Claim failed")}catch(r){console.error(r),alert(r.message||"Transaction failed")}finally{E(!1)}}},L=()=>{a!=null&&a.address&&navigator.clipboard.writeText(a.address)},M=r=>`${r.substring(0,6)}...${r.substring(38)}`;return e.jsxs("div",{className:"min-h-screen bg-background-primary text-text-primary p-4 pb-24 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pt-4",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>t(-1),children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold",children:s("referral.title","Referral System")}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider ml-1",children:s("referral.dashboard","Dashboard")}),e.jsx(C,{className:"bg-gradient-to-br from-background-secondary to-background-tertiary border-divider",children:e.jsxs(k,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary text-sm",children:s("referral.totalEarnings","Total Earnings")}),e.jsxs("div",{className:"text-3xl font-bold mt-1 text-accent",children:[(parseFloat(A)+parseFloat(D)).toFixed(2)," ",e.jsx("span",{className:"text-sm text-text-primary",children:"RADRS"})]})]}),e.jsx(fe,{className:"w-8 h-8 text-accent/50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-divider/50",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-text-secondary block mb-1",children:s("referral.bindingBonus","Binding Bonus")}),e.jsx("span",{className:"font-mono font-medium",children:parseFloat(A).toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-text-secondary block mb-1",children:s("referral.gasCommission","Gas Commission")}),e.jsxs("span",{className:"font-mono font-medium flex items-center gap-1",children:[parseFloat(D).toFixed(4)," ",e.jsx(ue,{className:"w-3 h-3 text-status-warning"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-background-secondary p-4 rounded-xl border border-divider",children:[e.jsx("span",{className:"text-xs text-text-secondary block mb-1",children:s("referral.invitedUsers","Invited Users")}),e.jsx("span",{className:"text-xl font-bold",children:J})]}),e.jsxs("div",{className:"bg-background-secondary p-4 rounded-xl border border-divider",children:[e.jsx("span",{className:"text-xs text-text-secondary block mb-1",children:s("referral.activeUsers","Active Users")}),e.jsx("span",{className:"text-xl font-bold",children:N.length})]})]}),N.length>0&&e.jsxs("div",{className:"bg-background-secondary rounded-xl border border-divider overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-divider/50 text-xs font-semibold text-text-secondary",children:s("referral.recentInvites","Recent Invites")}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:N.map((r,c)=>e.jsxs("div",{className:"flex justify-between items-center p-3 border-b border-divider/50 last:border-0 text-sm",children:[e.jsx("span",{className:"font-mono",children:M(r.wallet)}),e.jsx("span",{className:"text-text-secondary text-xs",children:new Date(r.bindTime*1e3).toLocaleDateString()})]},c))})]})]}),!p&&e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider ml-1",children:s("referral.bindReferrer","Bind Referrer")}),e.jsx(C,{className:"bg-background-secondary border-divider",children:e.jsxs(k,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(be,{className:"w-5 h-5 text-accent shrink-0 mt-1"}),e.jsx("p",{className:"text-sm text-text-secondary",children:s("referral.bindDesc","Bind a referrer to activate your account and unlock the 5 RADRS welcome bonus.")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ce,{placeholder:s("referral.referrerPlaceholder","0x... (Referrer Address)"),value:l,onChange:r=>X(r.target.value),className:b?"border-status-error":""}),e.jsx(m,{onClick:se,isLoading:Z,disabled:!l||!$||b,children:s("referral.bind","Bind")})]}),b&&e.jsx("p",{className:"text-xs text-status-error ml-1",children:s("referral.cannotBindSelf","Cannot bind yourself")})]})]})})]}),p&&e.jsx("div",{className:"bg-background-tertiary/50 border border-status-success/20 rounded-xl p-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-status-success"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-status-success",children:s("referral.referrerBound","Referrer Bound")}),e.jsx("p",{className:"text-xs text-text-secondary font-mono",children:M(j)})]})]})}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider ml-1",children:s("referral.newUserBonus","New User Bonus")}),e.jsxs(C,{className:"bg-background-secondary border-divider relative overflow-hidden",children:[e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-accent/20",style:{width:`${Math.min(d/200*100,100)}%`}}),e.jsxs(k,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:s("referral.claimTitle","Claim 5 RADRS")}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:s("referral.claimRequirement","Requirement: Hold â‰¥ 200 RADRS")})]}),e.jsx(le,{className:`w-8 h-8 ${d>=200?"text-accent":"text-text-secondary"}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-text-secondary",children:[e.jsx("span",{children:s("referral.currentBalance","Current Balance")}),e.jsxs("span",{children:[d.toFixed(2)," / 200 RADRS"]})]}),e.jsx("div",{className:"h-2 bg-background-primary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all duration-500",style:{width:`${Math.min(d/200*100,100)}%`}})})]}),Q?e.jsxs(m,{className:"w-full",variant:"outline",disabled:!0,children:[s("referral.claimed","Claimed")," ",e.jsx(q,{className:"ml-2 w-4 h-4"})]}):e.jsx(m,{className:"w-full",variant:"primary",onClick:re,isLoading:ee,disabled:!p||d<200,children:p?d<200?s("referral.insufficientBalance","Insufficient Balance"):s("referral.claimReward","Claim Reward"):s("referral.bindFirst","Bind Referrer First")})]})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-secondary uppercase tracking-wider ml-1",children:s("referral.promotionTools","Promotion Tools")}),e.jsxs("div",{className:"bg-background-secondary p-4 rounded-xl border border-divider space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 p-3 bg-background-primary rounded-lg border border-divider border-dashed",children:[e.jsx("div",{className:"truncate text-sm text-text-secondary font-mono",children:a==null?void 0:a.address}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:L,children:e.jsx(O,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{className:"flex-1",variant:"outline",onClick:L,children:[e.jsx(O,{className:"w-4 h-4 mr-2"})," ",s("referral.copyLink","Copy Link")]}),e.jsxs(m,{className:"flex-1",variant:"outline",children:[e.jsx(de,{className:"w-4 h-4 mr-2"})," ",s("referral.sharePoster","Share Poster")]})]}),e.jsx("p",{className:"text-xs text-text-secondary text-center px-4",children:s("referral.rulesDesc","Earn 10 RADRS for each referral + 10% Gas Commission permanently.")})]})]})]})]})}export{ke as default};
