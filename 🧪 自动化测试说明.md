# 🧪 钱包功能自动化测试说明

完成时间：2026-01-22

---

## 🎯 测试脚本功能

我已为您创建了一个自动化测试脚本 `test-wallet-functions.cjs`，可以自动测试钱包的核心功能。

### **测试项目（10 项）**

✅ **测试 1：BNB 余额查询**
✅ **测试 2：USDT 余额查询**
✅ **测试 3：RADRS 余额查询**
✅ **测试 4：BNB → USDT 报价查询**
✅ **测试 5：USDT → RADRS 报价查询**
✅ **测试 6：RADRS → BNB 报价查询**
✅ **测试 7：RPC 节点响应时间**
✅ **测试 8：Gas 价格查询**
✅ **测试 9：连续报价查询（性能测试）**
✅ **测试 10：地址验证**

---

## 📋 准备工作

### 1. 安装依赖

```bash
npm install
```

**需要的依赖包：**
- `viem` - 区块链交互库
- 其他依赖已在 `package.json` 中

---

### 2. 配置测试地址

打开 `test-wallet-functions.cjs`，修改第 18 行：

```javascript
const TEST_ADDRESS = '0xFEB445C3aF257D5D0742E8C3829B9CDBD2396BBF' // 替换为您的测试地址
```

**将地址改为您的钱包地址！**

---

## 🚀 运行测试

### 方法 1：直接运行（推荐）

```bash
node test-wallet-functions.cjs
```

### 方法 2：通过 npm（如果配置了 script）

```bash
npm test
```

---

## 📊 测试输出示例

```
══════════════════════════════════════════════════════════
            🧪 钱包功能自动化测试
══════════════════════════════════════════════════════════

测试地址: 0xFEB445C3aF257D5D0742E8C3829B9CDBD2396BBF
开始时间: 2026-01-22 14:30:00

🔍 测试 1：BNB 余额查询...
✅ [PASS] 测试 1：BNB 余额查询 (523ms) 余额: 0.0052 BNB

🔍 测试 2：USDT 余额查询...
✅ [PASS] 测试 2：USDT 余额查询 (612ms) 余额: 1.1255 USDT

🔍 测试 3：RADRS 余额查询...
✅ [PASS] 测试 3：RADRS 余额查询 (598ms) 余额: 70000.00 RADRS

💱 测试 4：BNB → USDT 报价查询...
✅ [PASS] 测试 4：BNB → USDT 报价查询 (1245ms) 报价: 0.6234 USDT (优秀)

💱 测试 5：USDT → RADRS 报价查询...
✅ [PASS] 测试 5：USDT → RADRS 报价查询 (1567ms) 报价: 68.95 RADRS (优秀)

💱 测试 6：RADRS → BNB 报价查询...
✅ [PASS] 测试 6：RADRS → BNB 报价查询 (1489ms) 报价: 0.000145 BNB (优秀)

🌐 测试 7：RPC 节点响应时间...
  https://bsc-dataseed1.binance.org: 456ms (优秀)
  https://bsc-dataseed2.binance.org: 523ms (优秀)
  https://bsc-dataseed.binance.org: 612ms (优秀)
  https://bsc.publicnode.com: 789ms (优秀)
✅ [PASS] 测试 7：RPC 节点响应时间 (595ms) 4/4 节点可用，平均 595ms

⛽ 测试 8：Gas 价格查询...
✅ [PASS] 测试 8：Gas 价格查询 (234ms) Gas 价格: 3.25 Gwei (低)

⚡ 测试 9：连续报价查询（性能测试）...
  第 1 次查询: 1234ms
  第 2 次查询: 1189ms
  第 3 次查询: 1256ms
✅ [PASS] 测试 9：连续报价查询（性能测试） (1226ms) 平均: 1226ms, 最快: 1189ms, 最慢: 1256ms (优秀)

🔐 测试 10：地址验证...
✅ [PASS] 测试 10：地址验证 (2ms) 地址验证逻辑正常

══════════════════════════════════════════════════════════
                    📊 测试报告
══════════════════════════════════════════════════════════

📈 测试统计:
  总测试数: 10
  通过: 10
  失败: 0
  通过率: 100.0%
  总耗时: 12.45s

⚡ 性能分析:
  平均测试时间: 987ms
  所有测试都在 3 秒内完成 ✓

🎯 关键指标:
  平均报价时间: 1434ms (优秀)
  平均余额查询时间: 578ms (优秀)

💡 建议:
  ✓ 所有测试通过，性能良好！

🏆 总体评级:
  ⭐⭐⭐ 优秀

══════════════════════════════════════════════════════════
                测试完成！
══════════════════════════════════════════════════════════

📄 详细报告已保存到: ./test-report.json

✅ 测试脚本执行完成
```

---

## 📊 测试报告

测试完成后，会生成一个 `test-report.json` 文件，包含所有测试的详细数据：

```json
{
  "startTime": 1706000000000,
  "tests": [
    {
      "name": "测试 1：BNB 余额查询",
      "status": "PASS",
      "duration": 523,
      "details": "余额: 0.0052 BNB",
      "data": {
        "balance": "0.0052"
      },
      "timestamp": "2026-01-22T06:30:00.000Z"
    },
    ...
  ],
  "summary": {
    "total": 10,
    "passed": 10,
    "failed": 0
  }
}
```

---

## 🎯 性能标准

### 余额查询
- **优秀**：< 1 秒
- **良好**：< 2 秒
- **需改进**：≥ 2 秒

### 报价查询
- **优秀**：< 2 秒
- **良好**：< 3 秒
- **需改进**：≥ 3 秒

### RPC 节点
- **优秀**：< 1 秒
- **良好**：< 3 秒
- **慢速**：≥ 3 秒

---

## 🔧 自定义测试

### 修改测试金额

在脚本中查找并修改以下行：

```javascript
// 测试 4：BNB → USDT
const amountIn = parseEther('0.001') // 修改这里，例如 '0.01'

// 测试 5：USDT → RADRS
const amountIn = parseEther('10') // 修改这里，例如 '20'

// 测试 6：RADRS → BNB
const amountIn = parseEther('100') // 修改这里，例如 '200'
```

---

### 添加更多 RPC 节点

在脚本中修改 `RPC_NODES` 数组：

```javascript
const RPC_NODES = [
  'https://bsc-dataseed1.binance.org',
  'https://bsc-dataseed2.binance.org',
  'https://bsc-dataseed.binance.org',
  'https://bsc.publicnode.com',
  // 添加更多节点...
]
```

---

### 修改连续查询次数

在 `testContinuousQuotes` 函数中修改：

```javascript
const iterations = 3 // 修改这里，例如 5 或 10
```

---

## 🚨 常见问题

### 问题 1：`Cannot find module 'viem'`

**解决方法：**
```bash
npm install viem
```

---

### 问题 2：测试失败 "余额查询异常"

**可能原因：**
- 测试地址配置错误
- RPC 节点无法访问
- 网络连接问题

**解决方法：**
1. 检查测试地址是否正确
2. 尝试更换 RPC 节点
3. 检查网络连接

---

### 问题 3：报价查询失败

**可能原因：**
- 流动性不足
- 代币合约地址错误
- RPC 节点超时

**解决方法：**
1. 检查代币合约地址
2. 增加超时时间
3. 更换 RPC 节点

---

### 问题 4：RPC 节点全部失败

**可能原因：**
- 网络防火墙
- 所有节点都不可用
- 超时设置太短

**解决方法：**
1. 检查网络设置
2. 尝试使用 VPN
3. 增加超时时间（在脚本中修改 `timeout: 10000`）

---

## 📈 性能优化建议

### 1. 选择最快的 RPC 节点

测试 7 会显示所有 RPC 节点的响应时间，选择最快的节点作为主节点：

```javascript
const publicClient = createPublicClient({
  chain: bsc,
  transport: http('最快的 RPC URL', {
    timeout: 10000,
    retryCount: 3
  })
})
```

---

### 2. 实现 RPC 负载均衡

可以根据测试结果，实现自动选择最快节点的逻辑。

---

### 3. 缓存机制

对于不经常变化的数据（如代币信息），可以添加缓存机制。

---

## 🎯 与手动测试对比

| 项目 | 手动测试 | 自动化测试 |
|------|---------|-----------|
| 测试时间 | 8-30 分钟 | 约 15 秒 |
| 数据精确度 | 主观估计 | 精确计时 |
| 可重复性 | 低 | 高 |
| 人工成本 | 高 | 低 |
| 覆盖范围 | 部分 | 全面 |
| 报告生成 | 手动 | 自动 |

**建议：** 自动化测试用于快速验证功能，手动测试用于 UI/UX 评估。

---

## 🔄 持续集成

可以将此测试脚本集成到 CI/CD 流程中：

### GitHub Actions 示例

```yaml
name: 钱包功能测试

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm install
      - name: Run tests
        run: node test-wallet-functions.cjs
```

---

## 📝 测试检查清单

运行测试前：
- [ ] 已安装 Node.js
- [ ] 已安装依赖 (`npm install`)
- [ ] 已配置测试地址
- [ ] 网络连接正常

运行测试后：
- [ ] 所有测试通过
- [ ] 性能达到标准
- [ ] 查看 `test-report.json`
- [ ] 记录问题并优化

---

## 🎉 总结

### 优势

✅ **自动化**：无需手动操作
✅ **快速**：15 秒完成所有测试
✅ **精确**：毫秒级性能数据
✅ **全面**：10 项核心功能测试
✅ **可重复**：随时运行测试
✅ **报告**：自动生成 JSON 报告

### 适用场景

✅ 快速验证功能
✅ 性能基准测试
✅ 持续集成
✅ 问题排查
✅ 性能监控

---

**现在就运行测试吧！** 🚀

```bash
node test-wallet-functions.cjs
```

═══════════════════════════════════════════════════════════
