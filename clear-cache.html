<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…é™¤é’±åŒ…ç¼“å­˜</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        .info {
            background: #e7f3ff;
            border-left-color: #0066cc;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: none;
        }
        .error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: none;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 14px;
        }
        .data-display {
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ é’±åŒ…ç¼“å­˜æ¸…é™¤å·¥å…·</h1>
        
        <div class="info">
            <strong>ğŸ“‹ è¯´æ˜ï¼š</strong><br>
            æ­¤å·¥å…·å°†å¸®åŠ©ä½ æ¸…é™¤é’±åŒ…çš„æœ¬åœ°ç¼“å­˜æ•°æ®ï¼Œè§£å†³åœ°å€é•¿åº¦é”™è¯¯çš„é—®é¢˜ã€‚<br>
            <strong>æ³¨æ„ï¼š</strong>è¿™åªä¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œä¸ä¼šä¿®æ”¹ä»»ä½•ä»£ç æ–‡ä»¶ã€‚
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 1: æŸ¥çœ‹å½“å‰æ•°æ®</h3>
            <button onclick="viewCurrentData()">ğŸ“Š æŸ¥çœ‹å½“å‰ç¼“å­˜æ•°æ®</button>
            <div id="currentData" class="data-display"></div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 2: å¤‡ä»½æ•°æ®ï¼ˆå¯é€‰ï¼‰</h3>
            <button onclick="backupData()">ğŸ’¾ å¤‡ä»½åˆ°å‰ªè´´æ¿</button>
            <button onclick="downloadBackup()">â¬‡ï¸ ä¸‹è½½å¤‡ä»½æ–‡ä»¶</button>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 3: æ¸…é™¤ç¼“å­˜</h3>
            <button class="danger" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
            <p style="color: #666; font-size: 14px; margin-top: 10px;">
                âš ï¸ ç‚¹å‡»åå°†æ¸…é™¤ localStorage ä¸­çš„é’±åŒ…æ•°æ®
            </p>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 4: åˆ·æ–°åº”ç”¨</h3>
            <button class="success" onclick="refreshApp()">ğŸ”„ åˆ·æ–°åº”ç”¨</button>
        </div>

        <div id="successMessage" class="success">
            <strong>âœ… æˆåŠŸï¼</strong><br>
            <span id="successText"></span>
        </div>

        <div id="errorMessage" class="error">
            <strong>âŒ é”™è¯¯ï¼</strong><br>
            <span id="errorText"></span>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 5: éªŒè¯ä¿®å¤</h3>
            <button onclick="verifyFix()">âœ”ï¸ éªŒè¯åœ°å€æ˜¯å¦æ­£ç¡®</button>
            <div id="verifyResult"></div>
        </div>
    </div>

    <script>
        function showSuccess(message) {
            const el = document.getElementById('successMessage');
            document.getElementById('successText').innerText = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showError(message) {
            const el = document.getElementById('errorMessage');
            document.getElementById('errorText').innerText = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function viewCurrentData() {
            try {
                const data = localStorage.getItem('app-store');
                if (!data) {
                    document.getElementById('currentData').innerHTML = '<p style="color: #999;">æ²¡æœ‰æ‰¾åˆ°ç¼“å­˜æ•°æ®</p>';
                    return;
                }

                const store = JSON.parse(data);
                const wallet = store.state?.wallets?.[0];
                
                let html = '<pre>';
                if (wallet) {
                    html += `<strong>é’±åŒ…ä¿¡æ¯ï¼š</strong>\n`;
                    html += `åç§°: ${wallet.name}\n`;
                    html += `åœ°å€: ${wallet.address}\n`;
                    html += `åœ°å€é•¿åº¦: ${wallet.address.length} ä¸ªå­—ç¬¦\n`;
                    html += `åå…­è¿›åˆ¶é•¿åº¦: ${wallet.address.substring(2).length} ä¸ªå­—ç¬¦\n`;
                    html += `EOA åœ°å€: ${wallet.eoaAddress || 'æœªçŸ¥'}\n`;
                    html += `\n<strong>çŠ¶æ€ï¼š</strong>\n`;
                    if (wallet.address.length === 42) {
                        html += `âœ… åœ°å€é•¿åº¦æ­£ç¡® (42ä¸ªå­—ç¬¦)\n`;
                    } else {
                        html += `âŒ åœ°å€é•¿åº¦é”™è¯¯ (å½“å‰: ${wallet.address.length}, åº”è¯¥: 42)\n`;
                    }
                } else {
                    html += 'âŒ æ‰¾ä¸åˆ°é’±åŒ…æ•°æ®\n';
                }
                html += '</pre>';
                
                document.getElementById('currentData').innerHTML = html;
                showSuccess('æ•°æ®åŠ è½½æˆåŠŸï¼');
            } catch (e) {
                showError('è¯»å–æ•°æ®å¤±è´¥: ' + e.message);
            }
        }

        function backupData() {
            try {
                const data = localStorage.getItem('app-store');
                if (!data) {
                    showError('æ²¡æœ‰æ•°æ®å¯ä»¥å¤‡ä»½');
                    return;
                }
                
                navigator.clipboard.writeText(data).then(() => {
                    showSuccess('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(err => {
                    showError('å¤åˆ¶å¤±è´¥: ' + err.message);
                });
            } catch (e) {
                showError('å¤‡ä»½å¤±è´¥: ' + e.message);
            }
        }

        function downloadBackup() {
            try {
                const data = localStorage.getItem('app-store');
                if (!data) {
                    showError('æ²¡æœ‰æ•°æ®å¯ä»¥ä¸‹è½½');
                    return;
                }
                
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `wallet-backup-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showSuccess('å¤‡ä»½æ–‡ä»¶å·²ä¸‹è½½ï¼');
            } catch (e) {
                showError('ä¸‹è½½å¤±è´¥: ' + e.message);
            }
        }

        function clearCache() {
            if (!confirm('ç¡®å®šè¦æ¸…é™¤ç¼“å­˜å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚\n\nå»ºè®®å…ˆå¤‡ä»½æ•°æ®ï¼')) {
                return;
            }
            
            try {
                // å…ˆè®°å½•æ—§æ•°æ®
                const oldData = localStorage.getItem('app-store');
                let oldAddress = 'æœªçŸ¥';
                if (oldData) {
                    const store = JSON.parse(oldData);
                    oldAddress = store.state?.wallets?.[0]?.address || 'æœªçŸ¥';
                }
                
                // æ¸…é™¤ç¼“å­˜
                localStorage.removeItem('app-store');
                
                showSuccess(`ç¼“å­˜å·²æ¸…é™¤ï¼\næ—§åœ°å€: ${oldAddress}\n\nè¯·ç‚¹å‡»"åˆ·æ–°åº”ç”¨"æŒ‰é’®é‡æ–°ç”Ÿæˆé’±åŒ…ã€‚`);
                
                // è‡ªåŠ¨æ˜¾ç¤ºå½“å‰æ•°æ®
                setTimeout(() => {
                    viewCurrentData();
                }, 1000);
            } catch (e) {
                showError('æ¸…é™¤å¤±è´¥: ' + e.message);
            }
        }

        function refreshApp() {
            if (confirm('ç¡®å®šè¦åˆ·æ–°åº”ç”¨å—ï¼Ÿ\n\nåˆ·æ–°åå°†é‡æ–°ç”Ÿæˆé’±åŒ…ã€‚')) {
                // æ‰“å¼€åº”ç”¨é¡µé¢
                window.open('http://localhost:5175/', '_blank');
                showSuccess('å·²æ‰“å¼€åº”ç”¨ï¼è¯·ç­‰å¾…å‡ ç§’åç‚¹å‡»"éªŒè¯ä¿®å¤"æŒ‰é’®ã€‚');
            }
        }

        function verifyFix() {
            try {
                const data = localStorage.getItem('app-store');
                if (!data) {
                    document.getElementById('verifyResult').innerHTML = 
                        '<p style="color: #f0ad4e; padding: 10px; background: #fcf8e3; border-radius: 4px;">âš ï¸ è¿˜æ²¡æœ‰æ–°æ•°æ®ã€‚è¯·å…ˆåˆ·æ–°åº”ç”¨å¹¶ç­‰å¾…é’±åŒ…ç”Ÿæˆã€‚</p>';
                    return;
                }

                const store = JSON.parse(data);
                const wallet = store.state?.wallets?.[0];
                
                if (!wallet) {
                    document.getElementById('verifyResult').innerHTML = 
                        '<p style="color: #d9534f; padding: 10px; background: #f2dede; border-radius: 4px;">âŒ æ‰¾ä¸åˆ°é’±åŒ…æ•°æ®</p>';
                    return;
                }

                const isCorrect = wallet.address.length === 42;
                const hexLength = wallet.address.substring(2).length;
                
                let html = '<div style="padding: 15px; border-radius: 6px; margin-top: 10px; ';
                
                if (isCorrect) {
                    html += 'background: #d4edda; border: 1px solid #28a745;">';
                    html += '<h4 style="color: #155724; margin: 0 0 10px 0;">âœ… ä¿®å¤æˆåŠŸï¼</h4>';
                    html += '<pre style="background: #fff; padding: 10px; border-radius: 4px;">';
                    html += `æ–°åœ°å€: ${wallet.address}\n`;
                    html += `æ€»é•¿åº¦: ${wallet.address.length} ä¸ªå­—ç¬¦ âœ…\n`;
                    html += `åå…­è¿›åˆ¶é•¿åº¦: ${hexLength} ä¸ªå­—ç¬¦ âœ…\n`;
                    html += `EOA åœ°å€: ${wallet.eoaAddress || 'æœªçŸ¥'}\n`;
                    html += '</pre>';
                    html += '<p style="color: #155724; margin: 10px 0 0 0;">ğŸ‰ åœ°å€æ ¼å¼æ­£ç¡®ï¼ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨é’±åŒ…äº†ã€‚</p>';
                } else {
                    html += 'background: #f8d7da; border: 1px solid #dc3545;">';
                    html += '<h4 style="color: #721c24; margin: 0 0 10px 0;">âŒ ä»ç„¶æœ‰é—®é¢˜</h4>';
                    html += '<pre style="background: #fff; padding: 10px; border-radius: 4px;">';
                    html += `åœ°å€: ${wallet.address}\n`;
                    html += `æ€»é•¿åº¦: ${wallet.address.length} ä¸ªå­—ç¬¦ âŒ (åº”è¯¥æ˜¯ 42)\n`;
                    html += `åå…­è¿›åˆ¶é•¿åº¦: ${hexLength} ä¸ªå­—ç¬¦ âŒ (åº”è¯¥æ˜¯ 40)\n`;
                    html += '</pre>';
                    html += '<p style="color: #721c24; margin: 10px 0 0 0;">è¯·å†æ¬¡æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°ã€‚</p>';
                }
                
                html += '</div>';
                document.getElementById('verifyResult').innerHTML = html;
                
            } catch (e) {
                document.getElementById('verifyResult').innerHTML = 
                    `<p style="color: #d9534f; padding: 10px; background: #f2dede; border-radius: 4px;">âŒ éªŒè¯å¤±è´¥: ${e.message}</p>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºå½“å‰æ•°æ®
        window.onload = function() {
            viewCurrentData();
        };
    </script>
</body>
</html>
