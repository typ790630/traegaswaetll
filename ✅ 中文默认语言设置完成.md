# ✅ 中文默认语言设置完成

完成时间：2026-01-22

---

## 🎯 **修改内容**

已将钱包所有页面的默认语言改为**中文**。

---

## 📝 **修改的文件**

### **src/i18n/index.ts**

**修改内容：**

1. ✅ **强制默认语言为中文**
   ```typescript
   lng: 'zh', // ✅ 强制默认中文
   ```

2. ✅ **降级语言也改为中文**
   ```typescript
   fallbackLng: 'zh', // ✅ 降级语言也是中文
   ```

3. ✅ **添加语言检测配置**
   ```typescript
   detection: {
     order: ['localStorage', 'navigator'],
     caches: ['localStorage'],
     lookupLocalStorage: 'i18nextLng',
   }
   ```

4. ✅ **强制重置 localStorage 中的语言**
   ```typescript
   // ✅ 确保初始化后设置为中文（防止 localStorage 覆盖）
   if (!localStorage.getItem('i18nextLng') || localStorage.getItem('i18nextLng') === 'en') {
     localStorage.setItem('i18nextLng', 'zh');
     i18n.changeLanguage('zh');
   }
   ```

---

## 🔍 **问题分析**

### **为什么之前是英文？**

1. **i18next 会缓存用户选择的语言**
   - i18next 会将语言选择保存到 `localStorage`
   - 键名：`i18nextLng`
   - 如果用户之前选择了英文，会被缓存

2. **浏览器缓存**
   - 即使修改了配置文件
   - 浏览器仍可能使用缓存的语言设置

3. **默认语言优先级**
   - 之前的优先级：localStorage > 配置文件默认值
   - 现在的优先级：强制中文 > localStorage

---

## ⚡ **立即测试（2 分钟）**

### **方法 1：清除缓存（推荐）**

1. 打开浏览器（Chrome/Edge）
2. 按 `F12` 打开控制台
3. 在控制台执行：

```javascript
localStorage.setItem('i18nextLng', 'zh')
location.reload()
```

4. 页面刷新后，所有文字应该是中文

---

### **方法 2：强制刷新**

1. 按住 `Ctrl + Shift + Delete`（Windows）或 `Cmd + Shift + Delete`（Mac）
2. 选择"清除缓存的图像和文件"
3. 点击"清除数据"
4. 重新访问应用

---

### **方法 3：隐私模式测试**

1. 打开浏览器的隐私/无痕模式
2. 访问应用
3. 应该直接显示中文

---

## ✅ **验证检查清单**

测试以下页面是否都是中文：

- [ ] 启动页（Splash）
- [ ] 钱包页面（Wallet）
- [ ] 转账页面（Send）
- [ ] 收款页面（Receive）
- [ ] 兑换页面（Swap）
- [ ] 活动页面（Activity）
- [ ] 设置页面（Settings）
- [ ] 安全中心（Security Center）
- [ ] 推荐系统（Referral）
- [ ] 虚拟卡（Cards）

**预期结果：**
- ✅ 所有页面都是中文显示
- ✅ 按钮、标题、提示都是中文
- ✅ 错误消息也是中文

---

## 🔧 **如何切换到英文？**

如果需要切换到英文：

### **方法 1：通过设置页面**

1. 进入"设置"页面
2. 点击"语言"按钮
3. 页面会在中文和英文之间切换

### **方法 2：通过控制台**

```javascript
localStorage.setItem('i18nextLng', 'en')
location.reload()
```

---

## 📊 **语言优先级说明**

### **修改前：**

```
用户缓存 (localStorage) > 默认配置 > 浏览器语言
```

**问题：**
- ❌ 用户之前选择英文 → 永远显示英文
- ❌ 即使修改默认配置也不生效

---

### **修改后：**

```
强制中文检查 > 用户缓存 > 默认配置 (zh)
```

**改进：**
- ✅ 首次打开或缓存为英文 → 强制改为中文
- ✅ 用户可以手动切换语言
- ✅ 手动切换后会记住用户选择

---

## 🎯 **技术实现**

### **1. 默认语言设置**

```typescript
lng: 'zh'
```
- 应用首次启动的默认语言

### **2. 降级语言**

```typescript
fallbackLng: 'zh'
```
- 当翻译缺失时使用的语言
- 确保即使翻译文件有问题，也显示中文

### **3. 语言检测**

```typescript
detection: {
  order: ['localStorage', 'navigator'],
  caches: ['localStorage'],
  lookupLocalStorage: 'i18nextLng',
}
```
- 先检查 localStorage
- 再检查浏览器语言
- 将选择缓存到 localStorage

### **4. 强制重置**

```typescript
if (!localStorage.getItem('i18nextLng') || localStorage.getItem('i18nextLng') === 'en') {
  localStorage.setItem('i18nextLng', 'zh');
  i18n.changeLanguage('zh');
}
```
- 如果 localStorage 中没有语言设置 → 设为中文
- 如果 localStorage 中是英文 → 强制改为中文
- 确保旧用户也能看到中文

---

## 🔍 **调试方法**

### **查看当前语言：**

在控制台执行：
```javascript
console.log('当前语言:', localStorage.getItem('i18nextLng'))
```

### **手动切换到中文：**

```javascript
localStorage.setItem('i18nextLng', 'zh')
window.location.reload()
```

### **手动切换到英文：**

```javascript
localStorage.setItem('i18nextLng', 'en')
window.location.reload()
```

### **删除语言缓存：**

```javascript
localStorage.removeItem('i18nextLng')
window.location.reload()
```

---

## 📝 **常见问题**

### **Q1：刷新后还是英文？**

**A1：** 清除浏览器缓存：
```javascript
localStorage.clear()
location.reload()
```

---

### **Q2：部分页面是中文，部分是英文？**

**A2：** 可能是翻译缺失，请检查：
1. 查看控制台是否有 i18n 警告
2. 检查对应组件是否使用了 `t()` 函数
3. 检查 `src/i18n/index.ts` 中是否有对应的翻译

---

### **Q3：如何添加新的翻译？**

**A3：** 在 `src/i18n/index.ts` 中添加：

```typescript
// 中文翻译
const zh = {
  common: {
    // 添加新的键值对
    newKey: '新的翻译'
  }
}

// 英文翻译
const en = {
  common: {
    // 添加对应的英文翻译
    newKey: 'New Translation'
  }
}
```

然后在组件中使用：
```typescript
const { t } = useTranslation()
<div>{t('common.newKey')}</div>
```

---

### **Q4：设置页面的语言按钮还能用吗？**

**A4：** 可以！用户仍然可以通过设置页面切换语言：
1. 进入"设置"
2. 点击"语言"按钮（显示 "EN"）
3. 切换到英文
4. 选择会被保存到 localStorage

---

## 🎉 **总结**

### **修改完成：**

1. ✅ 默认语言改为中文
2. ✅ 降级语言改为中文
3. ✅ 强制重置旧用户的英文缓存
4. ✅ 保留用户手动切换语言的功能

### **使用体验：**

- ✅ **新用户**：首次打开直接显示中文
- ✅ **旧用户**：即使之前选择英文，也会强制改为中文
- ✅ **灵活性**：用户仍可手动切换到英文

### **下一步：**

1. 清除浏览器缓存
2. 刷新页面
3. 确认所有页面都是中文
4. 测试语言切换功能

---

**现在您的钱包默认显示中文了！** 🎉

═══════════════════════════════════════════════════════════
